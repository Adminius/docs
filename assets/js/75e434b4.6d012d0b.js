"use strict";(self.webpackChunkevcc_docs=self.webpackChunkevcc_docs||[]).push([[8229],{3905:function(e,n,t){t.d(n,{Zo:function(){return p},kt:function(){return m}});var r=t(67294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function s(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)t=i[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)t=i[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var o=r.createContext({}),u=function(e){var n=r.useContext(o),t=n;return e&&(t="function"==typeof e?e(n):s(s({},n),e)),t},p=function(e){var n=u(e.components);return r.createElement(o.Provider,{value:n},e.children)},c={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},d=r.forwardRef((function(e,n){var t=e.components,a=e.mdxType,i=e.originalType,o=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),d=u(t),m=a,h=d["".concat(o,".").concat(m)]||d[m]||c[m]||i;return t?r.createElement(h,s(s({ref:n},p),{},{components:t})):r.createElement(h,s({ref:n},p))}));function m(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var i=t.length,s=new Array(i);s[0]=d;var l={};for(var o in n)hasOwnProperty.call(n,o)&&(l[o]=n[o]);l.originalType=e,l.mdxType="string"==typeof e?e:a,s[1]=l;for(var u=2;u<i;u++)s[u]=t[u];return r.createElement.apply(null,s)}return r.createElement.apply(null,t)}d.displayName="MDXCreateElement"},11810:function(e,n,t){t.r(n),t.d(n,{assets:function(){return p},contentTitle:function(){return o},default:function(){return m},frontMatter:function(){return l},metadata:function(){return u},toc:function(){return c}});var r=t(87462),a=t(63366),i=(t(67294),t(3905)),s=["components"],l={sidebar_position:3},o="Plugins",u={unversionedId:"reference/plugins",id:"reference/plugins",title:"Plugins",description:"Plugins k\xf6nnen verwendet werden, um verschiedene Ger\xe4te und externe Datenquellen in evcc zu integrieren. Diese k\xf6nnen \xfcber den Wert custom des Parameters type in meter (Strommessger\xe4te), charger (Wallboxen) oder vehicle (Fahrzeuge) verwendet werden.",source:"@site/docs/reference/plugins.md",sourceDirName:"reference",slug:"/reference/plugins",permalink:"/docs/reference/plugins",draft:!1,editUrl:"https://github.com/evcc-io/docs/tree/main/docs/reference/plugins.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"telemetry",permalink:"/docs/reference/configuration/telemetry"},next:{title:"Modbus",permalink:"/docs/reference/modbus"}},p={},c=[{value:"Modbus (lesen/schreiben)",id:"modbus-lesenschreiben",level:2},{value:"MQTT (lesen/schreiben)",id:"mqtt-lesenschreiben",level:2},{value:"HTTP (lesen/schreiben)",id:"http-lesenschreiben",level:2},{value:"Websocket (nur lesen)",id:"websocket-nur-lesen",level:2},{value:"SMA/Speedwire (nur lesen)",id:"smaspeedwire-nur-lesen",level:2},{value:"Javascript (lesen/schreiben)",id:"javascript-lesenschreiben",level:2},{value:"Shell Script (lesen/schreiben)",id:"shell-script-lesenschreiben",level:2},{value:"Calc (nur lesen)",id:"calc-nur-lesen",level:2},{value:"Kombinierter Status (nur lesen)",id:"kombinierter-status-nur-lesen",level:2}],d={toc:c};function m(e){var n=e.components,t=(0,a.Z)(e,s);return(0,i.kt)("wrapper",(0,r.Z)({},d,t,{components:n,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"plugins"},"Plugins"),(0,i.kt)("p",null,"Plugins k\xf6nnen verwendet werden, um verschiedene Ger\xe4te und externe Datenquellen in evcc zu integrieren. Diese k\xf6nnen \xfcber den Wert ",(0,i.kt)("inlineCode",{parentName:"p"},"custom")," des Parameters ",(0,i.kt)("inlineCode",{parentName:"p"},"type")," in ",(0,i.kt)("a",{parentName:"p",href:"/docs/reference/configuration/meters#custom"},(0,i.kt)("inlineCode",{parentName:"a"},"meter"))," (Strommessger\xe4te), ",(0,i.kt)("a",{parentName:"p",href:"/docs/reference/configuration/chargers#type"},(0,i.kt)("inlineCode",{parentName:"a"},"charger"))," (Wallboxen) oder ",(0,i.kt)("a",{parentName:"p",href:"/docs/reference/configuration/vehicles#custom"},(0,i.kt)("inlineCode",{parentName:"a"},"vehicle"))," (Fahrzeuge) verwendet werden."),(0,i.kt)("p",null,"Plugins erlauben sowohl ",(0,i.kt)("em",{parentName:"p"},"Schreibenzugriff")," also auch ",(0,i.kt)("em",{parentName:"p"},"Lesezugriff"),". Wenn das Plugin zum ",(0,i.kt)("em",{parentName:"p"},"Schreiben")," verwendet wird, werden die Daten in Form von ",(0,i.kt)("inlineCode",{parentName:"p"},"${var[:format]}")," zur Verf\xfcgung gestellt. Wenn ",(0,i.kt)("inlineCode",{parentName:"p"},"format")," nicht angegeben wird, werden die Daten im Standard ",(0,i.kt)("inlineCode",{parentName:"p"},"%v")," ",(0,i.kt)("a",{parentName:"p",href:"https://golang.org/pkg/fmt/"},"Go Format")," bereitgestellt. Die Variablen werden mit dem entsprechenden Wert ersetzt, bevor das Plugin ausgef\xfchrt wird."),(0,i.kt)("h2",{id:"modbus-lesenschreiben"},"Modbus (lesen/schreiben)"),(0,i.kt)("p",null,"Das ",(0,i.kt)("inlineCode",{parentName:"p"},"modbus")," Plugin kann Daten von jedem ModBus f\xe4higen Ger\xe4t oder SunSpec-kompatiblen Wechselrichter lesen. Viele Strommessger\xe4te sind bereits vorkonfiguriert (siehe ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/volkszaehler/mbmd#supported-devices"},"MBMD Supported Devices"),"). Es ist ebenfalls m\xf6glich Modbus Register zu Schreiben um weitere Wallboxen zu integrieren."),(0,i.kt)("p",null,"F\xfcr weitere Details siehe die ",(0,i.kt)("a",{parentName:"p",href:"modbus"},"Modbus Dokumentation")),(0,i.kt)("h2",{id:"mqtt-lesenschreiben"},"MQTT (lesen/schreiben)"),(0,i.kt)("p",null,"Das ",(0,i.kt)("inlineCode",{parentName:"p"},"mqtt")," Plugin erlaubt das Lesen von Werten \xfcber MQTT Topics. Das ist insbesondere f\xfcr Strommessger\xe4te n\xfctzlich, z.b. wenn diese ihre Daten bereits \xfcber MQTT bereitstellen.\nSiehe ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/volkszaehler/mbmd"},"MBMD")," f\xfcr ein Beispiel wie man Modbus Messdaten in MQTT bekommt. Das Plugin bietet auch die F\xe4higkeit JSON Datenstrukturen \xfcber jq-\xe4hnliche Abfragen zu lesen oder zu parsen (Siehe ",(0,i.kt)("a",{parentName:"p",href:"#http-readwrite"},"HTTP plugin"),")."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Beispiel Lesen"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"source: mqtt\ntopic: mbmd/sdm1-1/Power\ntimeout: 30s # don't accept values older than timeout\nscale: 0.001 # floating point factor applied to result, e.g. for Wh to kWh conversion\n")),(0,i.kt)("p",null,"F\xfcr den Schreibzugriff werden die Daten mit dem Attribut ",(0,i.kt)("inlineCode",{parentName:"p"},"payload")," bereitgestellt. Falls dieser Paramter in der Konfiguration fehlt, wird der Wert im Standardformat geschrieben."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Beispiel Schreiben"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"source: mqtt\ntopic: mbmd/charger/maxcurrent\npayload: ${var:%d}\n")),(0,i.kt)("h2",{id:"http-lesenschreiben"},"HTTP (lesen/schreiben)"),(0,i.kt)("p",null,"Das ",(0,i.kt)("inlineCode",{parentName:"p"},"http")," Plugin f\xfchrt HTTP Aufrufe durch um Daten zu lesen oder zu aktualisieren. Es beinhaltet auch die F\xe4higkeit JSON-Datenstrukturen \xfcber jq-Abfragen (z. B. f\xfcr REST-APIs) zu lesen oder zu parsen. "),(0,i.kt)("div",{className:"admonition admonition-important alert alert--info"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"important")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"XML-Dokumente werden intern automatisch in JSON-Form \xfcberf\xfchrt, welche dann mit jq wie eine native JSON-Antwort weiter gefiltert werden kann."))),(0,i.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"F\xfcr den Test von jq-Abfragen bietet sich z. B. das Online-Tool ",(0,i.kt)("a",{parentName:"p",href:"https://www.jsonquerytool.com/"},"https://www.jsonquerytool.com/")," und f\xfcr Regex-Tests z. B. das Online-Tool ",(0,i.kt)("a",{parentName:"p",href:"https://regex101.com/"},"https://regex101.com/")," an."))),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Beispiel Lesen"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"source: http\nuri: https://volkszaehler/api/data/<uuid>.json?from=now\nmethod: GET # default HTTP method\nheaders:\n- content-type: application/json\nauth: # basic authorization\n  type: basic\n  user: foo\n  password: bar\ninsecure: false # set to true to trust self-signed certificates\njq: .data.tuples[0][1] # parse response json\nscale: 0.001 # floating point factor applied to result, e.g. for kW to W conversion\ntimeout: 10s # timeout in golang duration format, see https://golang.org/pkg/time/#ParseDuration\n")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Beispiel Schreiben"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"body: %v # only applicable for PUT or POST requests\n")),(0,i.kt)("h2",{id:"websocket-nur-lesen"},"Websocket (nur lesen)"),(0,i.kt)("p",null,"Das ",(0,i.kt)("inlineCode",{parentName:"p"},"websocket")," Plugin bietet einen Websocket Listener. Es beinhaltet auch die F\xe4higkeit JSON Datenstrukturen \xfcber jq-\xe4hnliche Abfragen zu lesen oder zu parsen. Dies kann z.B. verwendet werden um Daten von Volksz\xe4hlers Push Server zu empfangen."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Beispiel Lesen"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'source: http\nuri: ws://<volkszaehler host:port>/socket\njq: .data | select(.uuid=="<uuid>") .tuples[0][1] # parse message json\nscale: 0.001 # floating point factor applied to result, e.g. for Wh to kWh conversion\ntimeout: 30s # error if no update received in 30 seconds\n')),(0,i.kt)("h2",{id:"smaspeedwire-nur-lesen"},"SMA/Speedwire (nur lesen)"),(0,i.kt)("p",null,"Das ",(0,i.kt)("inlineCode",{parentName:"p"},"sma")," Plugin bietet eine Schnittstelle zu SMA Ger\xe4ten welche das Speedwire Protokoll beherrschen."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Beispiel Lesen"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'source: sma\nuri: 192.168.4.51 # alternative to serial\nserial: 123456 # alternative to uri\nvalue: ActivePowerPlus # ID of value to read\npassword: "0000" # optional (default: 0000)\ninterface: eth0 # optional\nscale: 1 # optional scale factor for value\n')),(0,i.kt)("p",null,"Unterst\xfctzte Wert f\xfcr ",(0,i.kt)("inlineCode",{parentName:"p"},"value")," k\xf6nnen in der Diagnoseausgabe \xfcber das Kommando ",(0,i.kt)("inlineCode",{parentName:"p"},"evcc meter")," (mit konfigurierten SMA ",(0,i.kt)("inlineCode",{parentName:"p"},"meter")," Ger\xe4ten) gefunden werden."),(0,i.kt)("p",null,"Alle m\xf6glichen Werte k\xf6nnen als Konstanten ",(0,i.kt)("a",{parentName:"p",href:"https://gitlab.com/bboehmke/sunny/-/blob/master/values.go#L24"},"hier")," gefunden werden (verwende den Namen der Konstante f\xfcr ",(0,i.kt)("inlineCode",{parentName:"p"},"value"),")."),(0,i.kt)("h2",{id:"javascript-lesenschreiben"},"Javascript (lesen/schreiben)"),(0,i.kt)("p",null,"evcc integriert einen Javascript Interpreter mit der ",(0,i.kt)("a",{parentName:"p",href:"https://underscorejs.org"},"Underscore.js")," Bibliothek, welche direkt \xfcber ",(0,i.kt)("inlineCode",{parentName:"p"},"_.")," zugreifbar ist, z.B. ",(0,i.kt)("inlineCode",{parentName:"p"},"_.random(0,5)"),". Das ",(0,i.kt)("inlineCode",{parentName:"p"},"js")," Plugin kann Javascript code \xfcber den ",(0,i.kt)("inlineCode",{parentName:"p"},"script")," Parameter ausf\xfchren. Sehr hilfreich f\xfcr das schnelle Erstellen von Prototypen:"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Beispiel Lesen"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"source: js\nscript: |\n  var res = 500;\n  2 * res; // returns 1000\n")),(0,i.kt)("p",null,"Wenn das ",(0,i.kt)("inlineCode",{parentName:"p"},"js")," Plugin zum schreiben verwendet wird, wird der zu schreibenede Wert dem Script als Variable \xfcbergeben:"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Beispiel Schreiben"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"charger:\n- type: custom\n  maxcurrent:\n    source: js\n    script: |\n      console.log(maxcurrent);\n")),(0,i.kt)("h2",{id:"shell-script-lesenschreiben"},"Shell Script (lesen/schreiben)"),(0,i.kt)("p",null,"Das ",(0,i.kt)("inlineCode",{parentName:"p"},"script")," Plugin f\xfchrt externe Skripte zum Lesen oder Aktualisieren von Daten aus. Das Plugin ist hilfreich um jede Art von externer Funktionalit\xe4t einzubinden."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Beispiel Lesen"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'source: script\ncmd: /bin/bash -c "cat /dev/urandom"\ntimeout: 5s\n')),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Beispiel Schreiben"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"source: script\ncmd: /home/user/my-script.sh ${enable:%b} # format boolean enable as 0/1\ntimeout: 5s\n")),(0,i.kt)("h2",{id:"calc-nur-lesen"},"Calc (nur lesen)"),(0,i.kt)("p",null,"Das ",(0,i.kt)("inlineCode",{parentName:"p"},"calc")," Plugin erlaubt es mehrere Einzelwerte mathematisch weiterzuverarbeiten:"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Beispiel Lesen"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"source: calc\nadd:\n- source: ...\n  ...\n- source: ...\n  ...\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"source: calc\nmul:\n- source: calc\n  sign:\n    source: ... (power)\n  ...\n- source: ... (current)\n  ...\n")),(0,i.kt)("p",null,"Als Operanden werden dabei die Grundrechenarten Addition (add) und Multiplikation (mul) unterst\xfctzt."),(0,i.kt)("p",null,"Mit ",(0,i.kt)("inlineCode",{parentName:"p"},"scale: -1")," bei einem der Werte kann eine einfache Subtraktion durchgef\xfchrt werden, mit ",(0,i.kt)("inlineCode",{parentName:"p"},"scale: 0.001")," eine Division z. B. zur Konvertierung von kWh in Wh."),(0,i.kt)("p",null,"Mit ",(0,i.kt)("inlineCode",{parentName:"p"},"sign:")," (jede positive Zahl wird zu +1, jede negative Zahl wird zu -1, 0 bleibt 0) k\xf6nnen (in Verbindung mit ",(0,i.kt)("inlineCode",{parentName:"p"},"mul"),") Vorzeichen auf andere Werte \xfcbertragen werden. Z.B. um bei Z\xe4hlern die \u201eRichtung\u201c der Leistung (Einspeisung oder Bezug) auf die gemessenen Str\xf6me zu \xfcbertragen."),(0,i.kt)("p",null,"Das ",(0,i.kt)("inlineCode",{parentName:"p"},"calc")," Plugin ist hilfreich um z.B. "),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Leistungswerte von einzelnen PV-Strings zu summieren (addieren)"),(0,i.kt)("li",{parentName:"ul"},"Die Leistung aus Spannung und Strom zu berechnen (multiplizieren)"),(0,i.kt)("li",{parentName:"ul"},"Getrennte Leistungswerte f\xfcr Import und Export zu einem vorzeichenbehafteten Einzelwert zu kombinieren (subtrahieren)."),(0,i.kt)("li",{parentName:"ul"},"Prozentuale F\xfcllst\xe4nde zu berechnen (dividieren)"),(0,i.kt)("li",{parentName:"ul"},"Die richtige Richtung des Stromflusses festlegen (sign)")),(0,i.kt)("h2",{id:"kombinierter-status-nur-lesen"},"Kombinierter Status (nur lesen)"),(0,i.kt)("p",null,"Das ",(0,i.kt)("inlineCode",{parentName:"p"},"combined")," Status Plugin wird verwendet um gemischte Boolean Status Werte von ",(0,i.kt)("inlineCode",{parentName:"p"},"Plugged")," (angeschlossen) / ",(0,i.kt)("inlineCode",{parentName:"p"},"Charging")," (Laden) in einen evcc-kompatiblen Ladestatus von A..F zu konvertieren. Es wird z.b. zusammen mit einer OpenWB MQTT Integration verwendet."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Beispiel Lesen"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"source: combined\nplugged:\n  source: mqtt\n  topic: openWB/lp/1/boolPlugStat\ncharging:\n  source: mqtt\n  topic: openWB/lp/1/boolChargeStat\n")))}m.isMDXComponent=!0}}]);